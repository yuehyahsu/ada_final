case <- read_csv(./01_data/raw/Case.csv)
library(tidyverse)
case <- read_csv("./01_data/raw/Case.csv")
View(case)
source('C:/Users/yuehy/Google Drive/01_projects/ada_final/01_data/03_load_data.R', echo=TRUE)
head(case)
head(patient_info)
head(patient_route)
head(region)
head(seoul)
head(weather)
View(patient_info)
patient_info %>% count(disease)
patient_info %>% count(state)
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
#provide shorter names for variables
names(cerv)<-c("ID", "age_category","yr_dx", "sex", "race",
"insurance", "marital", "%pov", "%edu", "cause_spec_death",
"first_primary", "surv_mo", "vital_stat", "Stage")
#install.packages("survminer")#for pairwise diffs
#install.packages("ggfortify")
#install.packages("haven")
library(readr) #for read txt file
library(survival) #for calculating KM values
library(survminer)#for pairwise diffs
library(ggfortify) #for KM curves
library(readxl) # for reading in excel file
library(ggplot2) # for plotting KM curve
library(tidyverse) # for various packages
library(haven) #for read_csv
#load data for this exercise
cerv<- read_csv("SEERcerv2004to2015.csv") #load data for this exercise
str(cerv)
View(cerv)
#provide shorter names for variables
names(cerv)<-c("ID", "age_category","yr_dx", "sex", "race",
"insurance", "marital", "%pov", "%edu", "cause_spec_death",
"first_primary", "surv_mo", "vital_stat", "Stage")
##Recode stage variable as a factor variable and label it
table(cerv$Stage)
cerv$stage_f[
cerv$Stage=="IA"|
cerv$Stage=="IA1"|
cerv$Stage=="IA2"|
cerv$Stage=="IB"|
cerv$Stage=="IB1"|
cerv$Stage=="IB2"|
cerv$Stage=="INOS"]<-0
cerv$stage_f[
cerv$Stage=="IIA"|
cerv$Stage=="IIB"|
cerv$Stage=="IINOS"]<-1
cerv$stage_f[
cerv$Stage=="IIIA"|
cerv$Stage=="IIIB"|
cerv$Stage=="IIINOS"]<-2
cerv$stage_f[
cerv$Stage=="IVA"|
cerv$Stage=="IVB"|
cerv$Stage=="IVNOS"]<-3
cerv$stage_f<-factor(cerv$stage_f,
levels = c(0,1,2,3),
labels = c("Stage 1", "Stage 2", "Stage 3", "Stage 4"))
#Recode cause specific death as 1/0 if the person died/did not die of breast cancer
cerv$event_f[
cerv$cause_spec_death=="Dead (attributable to this cancer dx)"]<-1
cerv$event_f[
cerv$cause_spec_death=="Alive or dead of other cause"|
cerv$cause_spec_death=="N/A not first tumor"]<-0
#Recode insurance status as a factor variable and label it
cerv$insurance_f[
cerv$insurance=="Insured"]<-0
cerv$insurance_f[
cerv$insurance=="Insured/No specifics"]<-1
cerv$insurance_f[
cerv$insurance=="Any Medicaid"]<-2
cerv$insurance_f[
cerv$insurance=="Uninsured"]<-3
cerv$insurance_f<-factor(cerv$insurance_f,
levels = c(0,1,2,3),
labels = c("Insured", "Insured/No specifics", "Any Medicaid", "Uninsured"))
source('C:/Users/yuehy/Google Drive/01_projects/ada_final/__master_analysis_script.R', echo=TRUE)
region %>% count(city)
patient_info %>% count(city)
seoul %>% count(city)
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date)) %>%
left_join(region, by = c("province", "city"))
View(data)
resolved_date - confirmed_date
data$resolved_date - data$confirmed_date
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = "province")
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = "province") %>%
select(-code, -min_temp, -max_temp, -most_wind_direction)
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = c("province" = "province", "confirmed_date" = "date")) %>%
select(-code, -min_temp, -max_temp, -most_wind_direction)
ggplot(data) %>%
geom_histogram(aes(x = survival_days))
ggplot(data) +
geom_histogram(aes(x = survival_days))
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = c("province" = "province", "confirmed_date" = "date")) %>%
select(-code, -min_temp, -max_temp, -most_wind_direction) %>%
filter(survival_days >= 0) # there are some negative survival days -- bad data?
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = c("province" = "province", "confirmed_date" = "date")) %>%
select(-code, -min_temp, -max_temp, -most_wind_direction) %>%
filter(!(survival_days < 0)) # there are some negative survival days -- bad data?
data <- patient_info %>%
select(patient_id, sex, birth_year, age, province, city, infection_case, confirmed_date, released_date,
deceased_date, state) %>%
mutate(resolved_date = coalesce(released_date, deceased_date),
survival_days = resolved_date - confirmed_date) %>%
left_join(region, by = c("province", "city")) %>%
select(-code:-university_count, -nursing_home_count) %>%
left_join(weather, by = c("province" = "province", "confirmed_date" = "date")) %>%
select(-code, -min_temp, -max_temp, -most_wind_direction) %>%
filter(is.na(survival_days) | !(survival_days < 0)) # there are some negative survival days -- bad data?
saveRDS(data, file = "./01_data/processed/data.rds")
source('C:/Users/yuehy/Google Drive/01_projects/ada_final/__master_analysis_script.R', echo=TRUE)
ls()
